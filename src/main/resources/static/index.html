<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Download Lotus - é«˜æ€§èƒ½å¤šçº¿ç¨‹æ–‡ä»¶ä¸‹è½½å™¨ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€HTTP/SOCKSä»£ç†ã€å®æ—¶è¿›åº¦ç›‘æ§">
    <meta name="keywords" content="ä¸‹è½½å™¨,å¤šçº¿ç¨‹ä¸‹è½½,æ–­ç‚¹ç»­ä¼ ,ä»£ç†ä¸‹è½½,HTTPä¸‹è½½,SOCKSä»£ç†,æ–‡ä»¶ä¸‹è½½">
    <meta name="author" content="Download Lotus Team">
    <meta name="robots" content="noindex, nofollow">

    <title>ğŸš€Download Lotus - é«˜æ€§èƒ½å¤šçº¿ç¨‹ä¸‹è½½å™¨</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.svg">

    <!-- å¤–éƒ¨CSS -->
    <link rel="stylesheet" href="css/element-plus.css">
    <link rel="stylesheet" href="css/app.css">

    <!-- å¤–éƒ¨JSåº“ -->
    <script src="js/vue.global.js"></script>
    <script src="js/element-plus.js"></script>
    <script src="js/icons-vue.js"></script>
    <script src="js/sockjs.min.js"></script>
    <script src="js/stomp.min.js"></script>
    <script src="js/axios.min.js"></script>
</head>

<body>
    <div id="app" class="main-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>ğŸš€ Download Lotus <small style="font-size: 14px; color: #999;">V1.0.0</small></h2>
            <div style="display: flex; align-items: center; gap: 10px;">
                <el-tag size="small"
                    :type="wsStatus === 'connected' ? 'success' : wsStatus === 'connecting' ? 'warning' : 'danger'"
                    :title="wsError">
                    {{ wsStatus === 'connected' ? 'ğŸŸ¢ å·²è¿æ¥' : wsStatus === 'connecting' ? 'ğŸŸ¡ è¿æ¥ä¸­' : 'ğŸ”´ æ–­å¼€ (' + wsError
                    + ')' }}
                </el-tag>
                <el-button type="primary" @click="showCreateDialog = true" :icon="Plus">æ–°å»ºä»»åŠ¡</el-button>
            </div>
        </div>

        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <div v-for="task in tasks" :key="task.id">
            <el-card class="task-card" shadow="hover">
                <!-- æ ‡é¢˜è¡Œ -->
                <div class="task-info-row">
                    <div class="task-title" :title="task.fileName">{{ task.fileName || task.url }}</div>
                    <div>
                        <span v-if="task.status === 'DOWNLOADING'" class="speed-badge">
                            âš¡ {{ formatSize(task.speed) }}/s
                        </span>
                        <el-tag size="small" :type="getStatusType(task.status)" style="margin-left: 10px;">{{
                            task.status }}</el-tag>
                    </div>
                </div>

                <!-- è¿›åº¦æ–‡å­— -->
                <div class="task-info-row" style="font-size: 13px; color: #606266;">
                    <span>
                        {{ formatSize(task.downloaded) }} /
                        {{ task.totalSize > 0 ? formatSize(task.totalSize) : 'æœªçŸ¥å¤§å°' }}
                    </span>
                    <span>{{ formatPercent(task) }}%</span>
                    <el-link type="primary" :underline="false" @click="task.showGrid = !task.showGrid"
                        v-if="task.totalSize > 0 && task.supportRange" style="margin-left: 15px;">
                        {{ task.showGrid ? 'æ”¶èµ·åŒºå—' : 'æŸ¥çœ‹åŒºå—' }}
                        <el-icon class="el-icon--right">
                            <component :is="task.showGrid ? 'ArrowUp' : 'ArrowDown'" />
                        </el-icon>
                    </el-link>
                </div>

                <!-- æ ¸å¿ƒå¯è§†åŒ–ï¼š400æ ¼æ–¹é˜µ (ä»…å½“å·²çŸ¥å¤§å°æ—¶æ˜¾ç¤º) -->
                <div v-if="task.showGrid && task.totalSize > 0 && task.supportRange" class="grid-map">
                    <div v-for="(cell, idx) in getGridMap(task)" :key="idx" class="grid-cell"
                        :style="getCellStyle(cell)" :title="cell.tip">
                    </div>
                </div>
                <!-- æµå¼ä¸‹è½½æ˜¾ç¤ºè¿›åº¦æ¡ -->
                <div v-else-if="task.status === 'DOWNLOADING' && task.totalSize <= 0">
                    <el-progress :percentage="100" :indeterminate="true" :format="() => 'æµå¼ä¼ è¾“ä¸­...'"
                        striped></el-progress>
                </div>
                <!-- æµå¼ä¸‹è½½å®Œæˆ -->
                <div v-else-if="task.status === 'FINISHED' && task.totalSize <= 0">
                    <el-progress :percentage="100" status="success" :format="() => 'å·²å®Œæˆ'" striped></el-progress>
                </div>

                <!-- æ“ä½œæ  -->
                <div style="margin-top: 15px; text-align: right;">
                    <el-button-group>
                        <el-button v-if="task.status === 'FINISHED'" type="success" size="small"
                            @click="downloadToLocal(task)">
                            ğŸ“¥ å–å›æœ¬åœ°
                        </el-button>
                        <el-button type="primary" size="small" @click="copyDownloadLink(task)">
                            ğŸ“‹ å¤åˆ¶ä¸‹è½½é“¾æ¥
                        </el-button>
                        <el-button v-if="task.status === 'DOWNLOADING'" type="warning" size="small"
                            @click="control(task.id, 'pause')">æš‚åœ</el-button>
                        <el-button v-if="task.status === 'PAUSED'" type="success" size="small"
                            @click="control(task.id, 'resume')">â–¶ ç»§ç»­</el-button>
                        <el-button type="danger" size="small" @click="confirmDelete(task)">åˆ é™¤</el-button>
                    </el-button-group>
                </div>
            </el-card>
        </div>

        <!-- åˆ†é¡µ -->
        <el-pagination background layout="prev, pager, next" :total="totalTasks" :page-size="5"
            @current-change="handlePageChange" style="justify-content: center; margin-top: 20px;">
        </el-pagination>

        <!-- æ–°å»ºå¼¹çª— -->
        <el-dialog v-model="showCreateDialog" title="æ–°å»ºä¸‹è½½" width="550px">
            <el-form :model="form" label-width="100px">
                <el-form-item label="URL">
                    <el-input v-model="form.url" placeholder="https://..."></el-input>
                </el-form-item>
                <el-form-item label="çº¿ç¨‹æ•°">
                    <el-slider v-model="form.threads" :min="1" :max="32" show-input></el-slider>
                </el-form-item>
                <!-- ä»£ç†è®¾ç½® -->
                <el-divider content-position="left">ä»£ç†è®¾ç½® (å¯é€‰)</el-divider>
                <el-form-item label="ä»£ç†ç±»å‹">
                    <el-select v-model="form.proxyType" placeholder="è¯·é€‰æ‹©" clearable style="width: 100%;">
                        <el-option label="æ— ä»£ç†" value=""></el-option>
                        <el-option label="HTTP" value="HTTP"></el-option>
                        <el-option label="SOCKS" value="SOCKS"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="ä»£ç†æœåŠ¡å™¨" v-if="form.proxyType">
                    <el-input v-model="form.proxyHost" placeholder="ä¾‹å¦‚: 127.0.0.1"></el-input>
                </el-form-item>
                <el-form-item label="ä»£ç†ç«¯å£" v-if="form.proxyType">
                    <el-input-number v-model="form.proxyPort" :min="1" :max="65535" placeholder="1080"
                        style="width: 100%;"></el-input-number>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="showCreateDialog = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="createTask">å¼€å§‹ä¸‹è½½</el-button>
            </template>
        </el-dialog>
    </div>

    <!-- åº”ç”¨ä¸»é€»è¾‘ -->
    <script src="js/app.js"></script>
</body>

</html>